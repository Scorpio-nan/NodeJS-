<template>
	<div id="Register" ref="view">
		<scroller lock-x :height="viewHeight" ref="scrollerEvent">
			<div class="container">
				<x-input title="用户名" name="username" placeholder="请输入用户名(字母加数字组合)" type="text" v-model="Userobj.name"></x-input>
				<!--<p class="tips">*请输入以字母开头的6-15位字母、数字、下划线</p>-->
				<x-input title="密码" name="username" placeholder="请输入密码(字母加数字组合)" type="password" v-model="Userobj.pass"></x-input>
				<!--<p class="tips">*请使用6-20位英文、数字及下划线组合</p>-->
				<x-input title="邮箱" name="username" placeholder="请输入邮箱(正确的邮箱地址)" type="text" v-model="Userobj.email"></x-input>
				<x-input title="验证码" placeholder="请输入验证码" type="text" @on-focus="getCheckCode" v-model="Userobj.code">
					<div class="checkCode" slot="right-full-height" v-html="checkCode" @click="getCheckCode">

					</div>
				</x-input>

				<div class="btn">
					<x-button type="primary" @click.native="handleSubmit">注册</x-button>
				</div>
			</div>
		</scroller>
		<toast v-model="Modle.show" :type="Modle.type" :time="Modle.time" is-show-mask :text="Modle.txt" :position="Modle.pos"></toast>
	</div>
</template>

<script>
	import { XInput } from 'vux'
	import { Scroller } from 'vux'
	import { XButton } from 'vux'
	import { Toast } from 'vux'
	export default {
		components: {
			XInput,
			Scroller,
			XButton,
			Toast
		},
		name: 'Register',
		data() {
			let defaultStr = '<svg xmlns="http://www.w3.org/2000/svg" width="107" height="44"><path d="M14 16 C59 35,40 40,90 29" stroke="#444" fill="none"/><path d="M3 16 C73 21,45 18,106 8" stroke="#222" fill="none"/><path fill="#222" d="M36.45 37.87L36.46 37.88L36.38 37.79Q38.35 35.40 40.21 31.41L40.12 31.33L40.20 31.41Q38.08 27.09 34.17 21.90L34.12 21.85L34.16 21.89Q35.43 22.67 37.21 23.09L37.22 23.09L37.14 23.01Q39.49 26.10 41.06 29.45L41.00 29.39L41.00 29.40Q42.56 26.16 44.54 23.32L44.37 23.14L44.49 23.27Q45.85 22.99 47.20 22.47L47.26 22.53L47.19 22.46Q44.97 24.90 42.74 29.67L42.84 29.76L40.92 33.53L41.05 33.65Q40.13 35.67 39.01 37.36L38.84 37.19L38.91 37.26Q37.26 37.40 36.33 37.74ZM40.31 38.61L40.34 38.65L40.41 38.72Q41.44 36.78 42.37 34.68L42.45 34.76L44.24 30.72L44.24 30.73Q46.38 25.45 48.51 22.88L48.51 22.89L48.56 22.93Q47.70 23.37 46.48 23.81L46.46 23.80L47.20 22.97L47.09 22.85Q47.48 22.44 47.87 22.00L47.85 21.97L47.90 22.03Q46.21 22.73 44.37 23.03L44.28 22.93L44.24 22.89Q42.53 25.46 41.28 28.33L41.22 28.27L41.24 28.29Q40.17 26.14 39.02 24.33L39.12 24.43L39.16 24.48Q38.90 24.33 38.67 24.31L38.82 24.47L38.85 24.50Q38.51 24.36 38.39 24.36L38.50 24.47L38.48 24.45Q37.97 23.62 37.36 22.89L37.23 22.76L37.32 22.85Q35.30 22.44 33.54 21.34L33.52 21.32L33.53 21.33Q37.45 26.38 39.82 31.28L39.88 31.34L39.81 31.26Q38.52 34.62 35.90 38.25L35.90 38.24L35.92 38.26Q36.44 38.08 36.95 37.98L36.86 37.89L37.97 37.72L37.89 37.64Q37.64 38.24 36.88 39.30L36.84 39.26L36.78 39.20Q38.21 38.76 40.31 38.62Z"/><path d="M8 33 C68 14,59 30,93 25" stroke="#444" fill="none"/><path fill="#222" d="M59.38 29.60L59.34 29.56L59.53 29.75Q60.18 30.25 61.09 30.16L61.03 30.10L61.14 30.21Q62.89 30.20 63.30 28.04L63.43 28.17L63.35 28.09Q63.77 26.09 63.77 23.91L63.85 23.99L63.81 22.28L63.74 22.21Q63.87 21.53 63.65 20.72L63.51 20.59L63.53 20.61Q62.73 22.09 61.46 25.15L61.43 25.12L61.59 25.28Q60.32 28.33 59.53 29.75ZM62.64 19.03L62.58 18.97L62.65 19.05Q61.90 18.52 61.05 18.52L61.06 18.53L61.04 18.51Q60.22 18.55 59.51 19.13L59.40 19.02L59.34 18.96Q58.71 19.63 58.58 20.58L58.57 20.57L58.66 20.66Q58.39 21.49 58.36 22.44L58.27 22.35L58.24 22.32Q58.38 22.46 58.38 24.29L58.38 24.30L58.41 24.33Q58.42 25.85 58.72 28.18L58.64 28.10L58.68 28.14Q59.78 24.96 62.60 18.99ZM63.71 31.19L63.58 31.06L63.69 31.17Q62.65 31.84 61.15 31.84L61.10 31.78L60.07 31.81L60.08 31.82Q57.97 31.79 57.24 30.69L57.25 30.70L57.16 30.61Q56.67 29.24 56.62 27.35L56.59 27.32L56.71 27.45Q56.53 26.17 56.48 23.94L56.48 23.93L56.52 23.98Q56.63 23.32 56.53 21.36L56.44 21.28L56.48 21.32Q56.45 19.86 56.64 18.59L56.49 18.44L56.67 18.62Q56.99 16.74 59.78 16.59L59.66 16.47L59.72 16.53Q60.25 16.54 61.10 16.57L60.95 16.42L61.04 16.51Q64.66 16.58 65.35 18.81L65.45 18.91L65.44 18.90Q65.66 19.95 65.64 21.15L65.78 21.29L65.63 21.15Q65.63 24.40 65.58 25.18L65.59 25.19L65.69 25.29Q65.41 27.58 65.22 28.41L65.23 28.43L65.27 28.47Q64.97 30.59 63.74 31.22ZM66.85 31.00L66.79 30.94L66.91 31.06Q67.06 29.28 67.04 28.13L66.91 28.00L66.93 25.11L66.95 25.13Q66.97 23.27 66.63 19.72L66.60 19.69L66.60 19.69Q66.13 18.38 65.29 17.89L65.39 17.99L65.35 17.95Q64.43 16.40 61.10 16.30L60.95 16.15L61.10 16.30Q60.49 16.22 59.63 16.24L59.67 16.28L59.70 16.31Q56.72 16.30 56.41 18.31L56.40 18.30L56.31 18.21Q56.11 19.75 56.18 21.09L56.30 21.21L56.27 21.18Q56.42 23.93 56.40 26.08L56.43 26.11L56.35 26.04Q56.47 28.55 56.54 29.21L56.49 29.16L56.53 29.20Q56.61 31.01 57.59 31.53L57.66 31.60L57.73 31.67Q58.61 33.01 61.17 33.18L61.29 33.30L61.16 33.16Q63.53 33.38 63.95 33.36L63.96 33.38L63.84 33.25Q65.82 33.30 66.55 32.27L66.40 32.11L66.39 32.11Q66.85 31.81 66.89 31.05ZM61.40 29.98L61.29 29.87L61.37 29.95Q61.67 28.88 62.35 27.14L62.38 27.16L63.65 24.62L63.48 24.45Q63.61 25.66 63.37 27.81L63.35 27.79L63.33 27.77Q62.83 29.55 61.29 29.87ZM60.03 21.98L60.13 22.08L60.03 21.98Q60.43 20.93 60.87 20.57L60.75 20.45L60.83 20.52Q61.08 20.21 61.91 20.09L61.85 20.03L61.94 20.12Q60.88 22.51 59.68 25.49L59.65 25.47L59.60 25.41Q59.51 23.59 59.96 21.90Z"/><path fill="#333" d="M80.39 25.68L80.28 25.57L80.29 25.58Q80.40 25.69 82.58 25.67L82.56 25.65L82.50 25.59Q83.98 25.61 84.67 25.63L84.68 25.64L84.73 25.69Q83.89 23.67 82.32 20.05L82.49 20.22L82.32 20.05Q82.00 21.01 81.33 22.84L81.39 22.90L81.29 22.80Q80.76 24.78 80.39 25.69ZM85.46 27.30L85.43 27.28L85.40 27.24Q83.88 27.16 82.46 27.19L82.55 27.28L82.42 27.15Q81.03 27.23 79.56 27.35L79.54 27.32L79.53 27.32Q78.52 29.49 76.44 32.18L76.42 32.17L76.52 32.26Q74.83 32.63 73.95 32.95L73.95 32.95L74.02 33.02Q77.17 29.25 80.18 20.66L80.29 20.77L80.19 20.66Q81.12 18.58 82.00 16.50L81.99 16.49L81.93 16.43Q82.23 16.53 82.45 16.53L82.33 16.41L82.77 16.39L82.87 16.49Q83.33 17.34 86.44 24.83L86.45 24.84L86.50 24.89Q88.52 29.85 91.09 32.51L91.05 32.48L91.17 32.59Q90.83 32.50 88.33 31.94L88.25 31.85L88.24 31.84Q86.63 29.86 85.35 27.20ZM88.30 32.18L88.26 32.13L88.52 32.07L88.58 32.13Q88.67 32.08 88.87 32.16L88.95 32.24L88.89 32.18Q89.23 32.54 90.40 33.83L90.38 33.82L90.37 33.80Q92.76 34.43 94.30 35.09L94.21 35.00L94.17 34.96Q90.65 32.05 88.08 26.92L88.17 27.00L88.23 27.06Q87.07 24.83 86.14 22.28L86.08 22.22L84.48 17.57L84.44 17.52Q84.25 17.55 84.10 17.55L84.07 17.52L83.82 17.61L83.77 17.56Q83.51 17.11 83.05 16.23L83.01 16.19L82.97 16.15Q82.73 16.25 82.44 16.23L82.38 16.17L82.35 16.14Q82.06 16.12 81.72 16.12L81.82 16.22L81.77 16.17Q80.90 18.73 78.41 25.27L78.29 25.15L78.37 25.23Q76.32 30.30 73.33 33.38L73.39 33.44L73.43 33.48Q74.05 33.17 75.35 32.78L75.36 32.79L75.29 32.72Q74.91 33.39 73.91 34.54L73.81 34.45L73.79 34.43Q74.88 34.00 77.40 33.51L77.37 33.48L77.46 33.57Q79.69 30.80 80.69 28.72L80.71 28.74L80.72 28.76Q81.77 28.61 83.27 28.63L83.22 28.59L83.33 28.70Q85.01 28.64 85.89 28.68L85.93 28.73L85.82 28.61Q86.69 30.20 88.21 32.08ZM83.29 22.68L83.18 22.58L83.19 22.59Q83.82 24.00 84.31 25.35L84.34 25.38L82.11 25.27L82.20 25.36Q82.63 24.50 83.32 22.71Z"/><path fill="#333" d="M19.23 32.37L19.16 32.30L19.06 32.19Q16.52 25.11 13.22 21.90L13.19 21.87L13.24 21.93Q14.04 22.18 15.94 22.60L16.08 22.73L16.02 22.67Q18.30 25.20 19.94 29.48L19.86 29.40L19.89 29.43Q21.63 24.73 23.32 22.78L23.34 22.80L23.38 22.84Q24.49 22.60 26.06 22.16L26.15 22.25L26.09 22.19Q24.16 24.05 22.76 26.99L22.72 26.95L22.68 26.91Q22.40 27.30 20.23 32.19L20.40 32.37L20.37 32.33Q19.82 32.23 19.04 32.18ZM22.17 33.89L22.20 33.92L22.04 33.75Q24.31 25.97 27.25 22.96L27.29 23.01L26.20 23.18L26.33 23.32Q25.72 23.37 25.18 23.44L25.27 23.53L25.12 23.38Q25.42 23.12 25.95 22.56L26.09 22.69L26.02 22.63Q26.53 22.05 26.83 21.78L26.83 21.78L26.78 21.73Q25.51 22.30 23.31 22.62L23.31 22.62L23.16 22.48Q21.41 24.52 20.09 28.12L20.20 28.22L20.24 28.26Q19.09 25.47 17.91 23.88L17.90 23.87L17.68 23.99L17.54 23.85Q17.42 23.90 17.27 23.90L17.25 23.88L17.30 23.93Q17.15 23.71 16.05 22.38L15.95 22.29L15.97 22.30Q13.91 22.08 12.46 21.34L12.43 21.31L12.47 21.35Q16.43 25.04 19.00 32.58L18.93 32.51L19.62 32.56L19.64 32.58Q19.78 32.92 20.32 33.76L20.34 33.78L21.17 33.72L21.23 33.78Q21.74 33.82 22.15 33.87Z"/></svg>'
			return {
				viewHeight: "100px",
				checkCode: defaultStr,
				Userobj: {
					name: 'test666',
					pass: 'abc123',
					email: '2639319517@qq.com',
					code: ''
				},
				Modle:{
					show:false,
					type:'success',
					time:1000,
					txt:'Hello Word',
					pos:'middle'
				}
			}
		},
		beforeCreate() {
			this.$nextTick(() => {
				this.viewHeight = this.$refs.view.offsetHeight + 'px';
			})
		},
		methods: {
			getCheckCode() {
				let that = this;
				this.$Api.getCheckCode(res => {
					that.checkCode = res;
				})
			},
			handleSubmit() {
				if(this.formCheck()){
					this.Userobj.pass = $.md5(this.Userobj.pass);
					this.Userobj.code = this.Userobj.code.toLowerCase();
					this.$Api.register(this.Userobj, res => {
						console.log(res);
						if(res.state == 'error'){
							this.Modle.type = 'warn';
							this.Modle.txt = res.msg;
						}else{
							this.Modle.type = 'success';
							this.Modle.txt = '注册成功！';
							setTimeout(()=>{
								this.$router.push({path:'Login'});
							},1000)
						}
						this.Modle.show = true;
					})
				}else{
					this.Modle.show = true;
					this.Modle.type = 'warn';
				}
			},
			formCheck(){
				//用户名正则，4到16位（字母，数字，下划线）
				let userReg = /^[a-zA-Z0-9_]{4,8}$/;
				//密码强度正则，最少6位，包括至少1个小写字母，1个数字
				let passReg = /^.*(?=.{6,})(?=.*\d)(?=.*[a-z]).*$/;
				//Email正则
				let emailReg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
				if(!userReg.test(this.Userobj.name)){
					this.Modle.txt = '请输入正确的用户名';
					return false;
				}
				if(!passReg.test(this.Userobj.pass)){
					this.Modle.txt = '密码至少6位，且至少包含一个小写字母！';
					return false;
				}
				if(!emailReg.test(this.Userobj.email)){
					this.Modle.txt = '请输入正确的邮箱';
					return false;
				}
				if(this.Userobj.code == ''){
					this.Modle.txt = '验证码不能为空！';
					return false;
				}
				return true;
			}
		},
		mounted() {

		}
	}
</script>

<style lang="scss" scoped="scoped">
	.container {
		padding: 10px 12px;
		/*padding-left: 0;*/
		margin-top: 20px;
		.tips {
			font-size: 12px;
			padding-left: 12px;
			margin: 2px auto;
		}
		.btn {
			padding-top: 30px;
		}
	}
</style>